<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

  <?xml version="1.0" encoding="utf-8"?>
  <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

  <head>
    <title>guntamania</title>
    <link rel="icon" type="image/png" href="/static/favicon-32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/static/favicon-64.png" sizes="64x64">
    <link rel="icon" type="image/png" href="/static/favicon-128.png" sizes="128x128">
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta name="generator" content="ruby template engine" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <link rel="stylesheet"
          href="/css/sitemap.css"
          type="text/css"/>
    <script type="text/javascript"
	    src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script type="text/javascript" 
            src="/js/index.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-107284492-2"></script>
    <script>
     window.dataLayer = window.dataLayer || [];
     function gtag(){dataLayer.push(arguments);}
     gtag('js', new Date());

     gtag('config', 'UA-107284492-2');
    </script> 
    
  </head>
  
  <body>
    <HEADER>
      <H1 class="title"> <a class="title" href="/"> guntamania </a>
	<nav>
	  <ul>
	    <li class="menu" id="menu-articles"><a href="/works">WORKS</a></li>
	    <li class="menu"><a href="/diary">DIARY</a></li>
	    <li class="menu"><a href="/articles">ARTICLES</a></li>
	    
	  </ul>
	</nav>
      </H1>
    </HEADER>
    <article id="main-article">
      <div id="url" style="display:none;">https://medaka.github.io//diary/2020/08.html</div>
      <h2 id="0">Coroutinesã¨LiveDataã¨Koin</h2>
<span class="timestamp">[2020-08-16 Sun]</span>
<p>1å¹´ç¨‹åº¦æ”¾ç½®ã—ã¦ã—ã¾ã£ãŸã€‚
  é•·ã‚‰ãå‰¯æ¥­æ¡ˆä»¶ã—ã¦ã„ãŸãŒã€ä¹…ã€…ã«Androidã‚’ã‚­ãƒ£ãƒƒãƒã‚¢ãƒƒãƒ—ã—ã¦ã„ã®ã§ãƒ¡ãƒ¢ã€‚</p>
<p>è·å ´ã§ã¯RxJavaã°ã‹ã‚Šã„ã˜ã£ã¦ã„ã‚‹ãŒã€Kotlinã«ã¯Coroutinesã¨ã„ã†å¯¾æŠ—é¦¬ãŒã„ã‚‹ã€‚
  è‰²ã€…ãªãƒªãƒã‚¸ãƒˆãƒªè¦‹ã¦ã„ã‚‹é™ã‚Šã¾ã RxJavaã®ã»ã†ãŒå„ªå‹¢ãªã‚“ã ã‘ã©ã€ãã‚ãã‚Coroutinesã‚‚ä½¿ã„å¿ƒåœ°ã‚’ç¢ºã‹ã‚ãªã‘ã‚Œã°ã€‚</p>
<p><a href="https://satoshun.github.io/2019/12/android-viewodel-kotlin-coroutine/">ViewModelã¨Kotlin Coroutinesã®æ›¸ãæ–¹ã‚ã‚Œã“ã‚Œ | stsnã®ãƒ–ãƒ­ã‚°</a></p>
<p>ã“ã“ã®ã‚µã‚¤ãƒˆãŒéå¸¸ã«ã†ã¾ãã¾ã¨ã¾ã£ã¦ã„ãŸã€‚
  livedata builder ã¨ã„ã†ã®ãŒã‚ã‚‹ã®ã‹ã€‚ã€‚
  ã“ã‚Œã ã¨ç›¸å½“ç°¡å˜ã«ã‹ã‘ãã†ã ãŒã€æ±ç”¨æ€§ã«ã‹ã‘ãã†ã§ã‚‚ã‚ã‚‹ã€‚</p>
<p>ã‚ã¨ã¯Kotlinã®Koinã‚’ä½¿ãˆã°ViewModelã‚’ç°¡å˜ã«æ³¨å…¥ã§ãã‚‹ã®ãŒæ„Ÿå‹•ã—ãŸã€‚</p>
<pre class="src">
private val appModule = module {
    // ViewModel instance of MyViewModel
    // get() will resolve Repository instance
    viewModel { MainViewModel(get()) }
    factory { MainRepository(get())}
    factory { ApiClient() }
}
</pre>
<p>ã¨ã—ã¦ãŠãã¨ã€</p>
<pre class="src">
class MainFragment : Fragment() {
    private val mainViewModel : MainViewModel by viewModel()
    ...
</pre>
<p>ã“ã‚Œã ã‘ã§æ³¨å…¥ã§ãã¦ã—ã¾ã†..
  ä»Šã¾ã§ã ã¨ <code>Activity</code> ã‹ã‚‰ <code>obtainViewModel</code> ã‚’å®Ÿè£…ã—ã¦ <code>ViewModel</code>
  ã‚’ã‚‚ã‚‰ã£ã¦ãã‚‹å¿…è¦ãŒã‚ã£ãŸãŒ..
  ã“ã‚Œã¯ä¾¿åˆ©ã ã€‚</p>
<p>ãŸã ã—ã€ <code>LifeCycleOwner</code> ã®æ³¨å…¥ã¯å¿˜ã‚Œãªã„ã‚ˆã†ã«ã—ã‚ˆã†</p>
<pre class="src">
override fun onActivityCreated(savedInstanceState: Bundle?) {
    super.onActivityCreated(savedInstanceState)
    viewDataBinding.lifecycleOwner = this.viewLifecycleOwner
}
</pre>
<p>viewDataBindingã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã«ã“ã‚Œã‚’å¿˜ã‚Œã¦ã„ãŸ..
  å„€å¼çš„ãªã‚‚ã®ã¯ã‚ã¾ã‚Šæ„å‘³ã‚’è€ƒãˆãªã„ã‹ã‚‰ã¤ã„ã¤ã„æ¥½ã‚’ã™ã‚‹ã¨å¿˜ã‚Œã¦ã—ã¾ã†ã‚“ã ã‚ˆã­..</p>
<h2 id="1">LiveData ã‚’æ›´æ–°ã—ãŸã„</h2>
<span class="timestamp">[2020-08-19 Wed]</span>
<p>LiveData Coroutine Builder ä½¿ã£ã¦UIã‚’è¡¨ç¤ºã—ãŸã„</p>
<p>å˜ç´”ã« ViewModelãªã‚“ã‹ã«æ›¸ãã¨</p>
<pre class="src">
val user = liveData&lt;User&gt; { runCatching { repository.getUser() } }
</pre>
<p>ã£ã¦ã„ã†ã‚³ãƒ¼ãƒ‰ã«ãªã‚‹ã‚“ã ã‘ã©ã€å€¤ã‚’æ›´æ–°ã—ãŸã„ã¨ãã«</p>
<pre class="src">
viewmodel.user.observe(viewLifecycleOwner, .. )
</pre>
<p>ã¨ã‹ã£ã¦æ›¸ã„ã¦ã¿ã‚‹ã‚“ã ã‘ã©å‹•ã„ã¦ãã‚Œãªã„..</p>
<p>ã§ã€ä»¥ä¸‹ã®è¨˜äº‹ã‚’å‚è€ƒã«ã™ã‚‹ã€‚</p>
<p><a href="https://medium.com/@star_zero/livedata-coroutines-f658cc055f04">LiveData ğŸ¤ Coroutines</a></p>
<p>å¼•ç”¨ã•ã›ã¦ã„ãŸã ã</p>
<pre class="src">
private val _refresh = MutableLiveData&lt;Unit&gt;()
val data = _refresh.switchMap {
    liveData {
        emit(repository.getData())
    }
}
fun refresh() {
    _refresh.value = null
}
</pre>
<p>ãªã‚‹ã»ã©ã€è³¼èª­å¯¾è±¡ã‚’ä¸€å€‹å¢—ã‚„ã—ã¦ã‚„ã‚‹ã‚“ã ãª..</p>
<p>ã ã‘ã©ã‚‚ã©ã†ã‚‚ã“ã®æ–¹æ³•ã¯ã‚¢ãƒ‰ãƒ›ãƒƒã‚¯ãªæ„Ÿã˜ãŒã‚ã‚‹ã€‚
  æ™®é€šã« <code>liveData{ .. }</code> ãŒMutableLiveDataã‚’è¿”ã—ã¦ãã‚Œã‚Œã°ã„ã„ã‚“ã ã‘ã©..</p>
<p>ã¨ã“ã‚ã§ã€ã“ã® <code>liveData{ .. }</code> ã¨ã„ã†æ‹¡å¼µãŒéå¸¸ã«ã‚°ã‚°ã‚Šãšã‚‰ã„ã—ã€Githubã‚‚æ¤œç´¢ã—ã¥ã‚‰ã„ã€‚
  å˜ã«ãƒœã‚¿ãƒ³UIã§å€¤ã‚’æ›´æ–°ã—ãŸã„ã¨ã‹ãªã®ã«ã€ãã‚Œã§ã“ã‚“ãªã‚¢ãƒ‰ãƒ›ãƒƒã‚¯ãªæ–¹æ³•ä½¿ã‚ãªã„ã¨ã„ã‘ãªã„ã¨ã—ãŸã‚‰ã€ã¡ã‚‡ã£ã¨ãã¤ã„ã‹ã‚‚ã—ã‚Œãªã„ã€‚</p>
    </article>
    
    
    <footer>
      <nav class="footer">
	<p class="copyright">Copyright 2018</p>
      </nav>
    </footer>
  </body>
</html>

